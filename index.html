<script>
let conteudos = JSON.parse(localStorage.getItem("conteudos") || "[]");
let questoes = JSON.parse(localStorage.getItem("questoes") || "[]");
let resultados = JSON.parse(localStorage.getItem("resultados") || "[]");

function showSection(id){
    document.querySelectorAll(".container").forEach(c=>c.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");

    if(id==="conteudos") listarConteudos();
    if(id==="atividades") listarQuestoes("atividade","listaAtividades");
    if(id==="simulados") listarQuestoes("simulado","listaSimulados");
    if(id==="ade") listarQuestoes("ade","listaADE");
    if(id==="saeb") listarQuestoes("saeb","listaSAEB");
    if(id==="resultados") listarResultados();
}

function abrirAdmin(){
    let senha = prompt("Senha do administrador:");
    if(senha==="1234"){
        showSection("adminPanel");
        listarAdminQuestoes();
    } else alert("Senha incorreta");
}

function salvarConteudo(){
    let file = arquivoConteudo.files[0];
    let reader = new FileReader();
    reader.onload = function(){
        conteudos.push({titulo:tituloConteudo.value,arquivo:reader.result});
        localStorage.setItem("conteudos",JSON.stringify(conteudos));
        alert("ConteÃºdo salvo!");
        listarConteudos();
    }
    if(file) reader.readAsDataURL(file);
}

function listarConteudos(){
    listaConteudos.innerHTML="";
    conteudos.forEach((c,i)=>{
        listaConteudos.innerHTML+=`
        <div class="question">
            <b>${c.titulo}</b><br>
            <a href="${c.arquivo}" target="_blank">ğŸ“‚ Abrir material</a>
            <button class="small-btn" onclick="editarConteudo(${i})">âœï¸</button>
            <button class="small-btn" onclick="excluirConteudo(${i})">ğŸ—‘</button>
        </div>`;
    });
}

function editarConteudo(i){
    tituloConteudo.value = conteudos[i].titulo;
    conteudos.splice(i,1);
    localStorage.setItem("conteudos",JSON.stringify(conteudos));
    listarConteudos();
}

function excluirConteudo(i){
    if(confirm("Excluir conteÃºdo?")){
        conteudos.splice(i,1);
        localStorage.setItem("conteudos",JSON.stringify(conteudos));
        listarConteudos();
    }
}

function salvarQuestao(){
    let reader = new FileReader();
    let file = imagemQuestao.files[0];

    reader.onload = function(){
        questoes.push({
            tipo:tipoQuestao.value,
            pergunta:pergunta.value,
            texto:textoQuestao.value,
            img:reader.result,
            a:a.value,b:b.value,c:c.value,d:d.value,
            correta:correta.value
        });
        localStorage.setItem("questoes",JSON.stringify(questoes));
        alert("QuestÃ£o salva!");
        listarAdminQuestoes();
    };
    if(file) reader.readAsDataURL(file);
    else reader.onload();
}

function listarQuestoes(tipo,elemento){
    document.getElementById(elemento).innerHTML="";

    questoes
    .filter(q=>q.tipo===tipo)
    .forEach((q,i)=>{
        document.getElementById(elemento).innerHTML+=`
        <div class="question">
            <p><b>${i+1}. ${q.pergunta}</b></p>
            <p>${q.texto||""}</p>
            ${q.img?`<img src="${q.img}" width="150"><br>`:""}

            <label class="alternativa"><input type="radio" name="${tipo}${i}" value="A"> A) ${q.a}</label>
            <label class="alternativa"><input type="radio" name="${tipo}${i}" value="B"> B) ${q.b}</label>
            <label class="alternativa"><input type="radio" name="${tipo}${i}" value="C"> C) ${q.c}</label>
            <label class="alternativa"><input type="radio" name="${tipo}${i}" value="D"> D) ${q.d}</label>
        </div>`;
    });
}

function listarAdminQuestoes(){
    listaAdminQuestoes.innerHTML="";
    questoes.forEach((q,i)=>{
        listaAdminQuestoes.innerHTML+=`
        ${q.pergunta}
        <button class="small-btn" onclick="editarQuestao(${i})">âœï¸</button>
        <button class="small-btn" onclick="excluirQuestao(${i})">ğŸ—‘</button><br>`;
    });
}

function excluirQuestao(i){
    if(confirm("Excluir questÃ£o?")){
        questoes.splice(i,1);
        localStorage.setItem("questoes",JSON.stringify(questoes));
        listarAdminQuestoes();
    }
}

function editarQuestao(i){
    let q=questoes[i];
    pergunta.value=q.pergunta;
    textoQuestao.value=q.texto;
    a.value=q.a; b.value=q.b; c.value=q.c; d.value=q.d;
    correta.value=q.correta;
    questoes.splice(i,1);
    localStorage.setItem("questoes",JSON.stringify(questoes));
    listarAdminQuestoes();
}

function listarResultados(){
    relatorios.innerHTML="";
    resultados.forEach(r=>{
        relatorios.innerHTML+=`<p>${r.nome||"Aluno"} â†’ âœ… ${r.acertos} | âŒ ${r.erros}</p>`;
    });
}

window.onload = function(){
    listarConteudos();
    listarQuestoes("atividade","listaAtividades");
    listarQuestoes("simulado","listaSimulados");
    listarQuestoes("ade","listaADE");
    listarQuestoes("saeb","listaSAEB");
    listarResultados();
}
</script>
